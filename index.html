<iframe id="spotifyFrame" width="50%" height="152" frameborder="0"
        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
</iframe>

<!-- Geen muziek melding -->
<p id="noMusicMessage" style="display: none; text-align: center; font-size: 18px; font-weight: bold; color: white;">
    🎵 Er speelt momenteel geen muziek op Spotify 🎵
</p>



<script>
const CLIENT_ID = "adfb40a14b7844eea65949e04c98fe11"; // Jouw Spotify Client ID
const REDIRECT_URI = "https://AlbertjanPieffers.github.io/spotify-now-playing/"; // Jouw redirect URL
const SCOPES = "user-read-currently-playing";

// ✅ Functie om de token op te halen
function getAccessToken() {
    const urlParams = new URLSearchParams(window.location.hash.substr(1));
    return urlParams.get("access_token");
}

// ✅ Functie om te checken of Spotify momenteel muziek afspeelt
async function fetchSpotifyNowPlaying(token) {
    console.log("🔍 Controleren of Spotify momenteel muziek afspeelt...");

    try {
        const response = await fetch("https://api.spotify.com/v1/me/player/currently-playing", {
            method: "GET",
            headers: { "Authorization": `Bearer ${token}` }
        });

        console.log(`📡 Spotify API Response Status: ${response.status}`);

        if (response.status === 401) { // Token verlopen of gebruiker niet ingelogd
            console.error("⚠️ Token verlopen of gebruiker niet ingelogd.");
            return;
        }

        if (response.status === 204) { // Geen muziek speelt, maar gebruiker is WEL ingelogd
            console.log("🎵 Geen muziek speelt momenteel, maar gebruiker is ingelogd. Toon melding.");
            document.getElementById("spotifyFrame").style.display = "none";
            document.getElementById("noMusicMessage").style.display = "block";
            return;
        }

        if (!response.ok) { // Andere fout
            console.error(`❌ Onverwachte fout bij ophalen Spotify data. Status: ${response.status}`);
            return;
        }

        const data = await response.json();
        console.log("✅ Spotify API Response ontvangen:", data);

        if (data && data.item) {
            const trackId = data.item.id;
            console.log(`🎶 Nummer gevonden: ${data.item.name} - Embed Track: ${trackId}`);
            document.getElementById("spotifyFrame").src = `https://open.spotify.com/embed/track/${trackId}`;
            document.getElementById("spotifyFrame").style.display = "block";
            document.getElementById("noMusicMessage").style.display = "none";
        } else {
            console.warn("🎵 Geen nummer speelt momenteel, maar gebruiker is ingelogd.");
            document.getElementById("spotifyFrame").style.display = "none";
            document.getElementById("noMusicMessage").style.display = "block";
        }
    } catch (error) {
        console.error("❌ Fout bij ophalen Spotify data:", error);
    }
}

// ✅ Token ophalen en checken
let token = getAccessToken();

if (token) {
    console.log("✅ Token gevonden! Controleren of Spotify muziek afspeelt...");
    fetchSpotifyNowPlaying(token);
    setInterval(() => fetchSpotifyNowPlaying(token), 10000); // Update elke 10 seconden
} else {
    console.warn("⚠️ Geen Spotify token gevonden. Gebruiker moet inloggen.");
}
</script>
