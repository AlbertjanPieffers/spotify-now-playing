<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spotify Now Playing</title>
        
<p id="noMusicMessage" style="text-align: center; font-size: 18px; font-weight: bold; color: white;">
    ðŸŽµ Er speelt momenteel geen muziek af.. ðŸŽµ
</p>

  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      text-align: center;
      background-color: transparent;
      color: white;
    }
    #spotifyFrame {
      width: 100%;
      height: 152px;
      border: none;
    }
    #noMusicMessage {
      font-size: 18px;
      font-weight: bold;
      color: white;
    }
    #loginBtn {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #1DB954;
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<iframe id="spotifyFrame" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
<p id="noMusicMessage" style="display: none;">ðŸŽµ Er speelt momenteel geen muziek op Spotify ðŸŽµ</p>
<button id="loginBtn" style="display: none;">Log in met Spotify</button>

<script>
  const CLIENT_ID = "adfb40a14b7844eea65949e04c98fe11";
  const REDIRECT_URI = "https://albertjanpieffers.github.io/spotify-now-playing/";
  const SCOPES = "user-read-currently-playing";

  function getAccessToken() {
    const urlParams = new URLSearchParams(window.location.hash.substr(1));
    return urlParams.get("access_token");
  }

  function redirectToSpotifyAuth() {
    const authUrl = `https://accounts.spotify.com/authorize?client_id=${CLIENT_ID}&response_type=token&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=${encodeURIComponent(SCOPES)}`;
    window.open(authUrl, '_blank');
  }

  async function fetchSpotifyNowPlaying(token) {
    try {
      const response = await fetch("https://api.spotify.com/v1/me/player/currently-playing", {
        method: "GET",
        headers: { "Authorization": `Bearer ${token}` }
      });

      if (!response.ok) {
        console.warn("Geen geldige Spotify data.");
        document.getElementById("noMusicMessage").style.display = "block";
        return;
      }

      const data = await response.json();

      if (data && data.item) {
        const trackId = data.item.id;
        document.getElementById("spotifyFrame").src = `https://open.spotify.com/embed/track/${trackId}`;
        document.getElementById("noMusicMessage").style.display = "none";
      } else {
        document.getElementById("noMusicMessage").style.display = "block";
      }
    } catch (error) {
      console.error("Fout bij ophalen Spotify info:", error);
      document.getElementById("noMusicMessage").style.display = "block";
    }
  }

  const token = getAccessToken();

  if (!token) {
    document.getElementById("loginBtn").style.display = "inline-block";
    document.getElementById("loginBtn").addEventListener("click", redirectToSpotifyAuth);
  } else {
    fetchSpotifyNowPlaying(token);
    setInterval(() => fetchSpotifyNowPlaying(token), 10000);
  }
</script>

</body>
</html>



