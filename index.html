<iframe id="spotifyFrame" width="100%" height="152" frameborder="0"
        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
</iframe>

<script>
const CLIENT_ID = "adfb40a14b7844eea65949e04c98fe11"; // Vervang met je Spotify Client ID
const REDIRECT_URI = "AlbertjanPieffers.github.io"; // Vervang met je redirect URL
const SCOPES = "user-read-currently-playing";

function getAccessToken() {
    const urlParams = new URLSearchParams(window.location.hash.substr(1));
    return urlParams.get("access_token");
}

function redirectToSpotifyAuth() {
    const authUrl = `https://accounts.spotify.com/authorize?client_id=${CLIENT_ID}&response_type=token&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=${encodeURIComponent(SCOPES)}`;
    window.location.href = authUrl;
}

async function fetchSpotifyNowPlaying(token) {
    const response = await fetch("https://api.spotify.com/v1/me/player/currently-playing", {
        method: "GET",
        headers: { "Authorization": `Bearer ${token}` }
    });

    if (!response.ok) {
        console.error("Error fetching Spotify data");
        return;
    }

    const data = await response.json();
    if (data && data.item) {
        const trackId = data.item.id;
        document.getElementById("spotifyFrame").src = `https://open.spotify.com/embed/track/${trackId}`;
    }
}

// 1. Check of er een access token is
let token = getAccessToken();

if (!token) {
    redirectToSpotifyAuth();
} else {
    fetchSpotifyNowPlaying(token);
    setInterval(() => fetchSpotifyNowPlaying(token), 10000); // Update elke 10 seconden
}
</script>
